let sim = null;
let initialConditions = [
	new Vector(-70, '40% height'), // initial position
	new Vector(20, 10),  // initial velocitity
	0,   // initial engine angle
	0    // initial thrust amount
];
let terrainPrecision = 2;
let mutationRate = 0.1;
let simulationSpeed = 1; // min = 1

function launchSimulation() {
	let populationSize  = 5;

	// Neural Network
	let hiddenNeurons     = 20;
	let controlersNN      = Array(populationSize).fill(NeuralNetworkControler);
	let controlersDatasNN = Array(populationSize).fill([ hiddenNeurons ]);

	// Neuro Evolution
	let controlersNE     = Array(populationSize).fill(NEATControler);
	let controlerDatasNE = Array(populationSize);

	// Last controler is an Human
	// controlers.push(HumanControler);
	// controlersDatas.push([ ]);
	// populationSize += 1;
	// sim.addVesselFromJSON(vesselData, 100);
	sim.initialize();

	// sim.newPopulation(populationSize, controlersNN, controlersDatasNN);
	// sim.newPopulation(populationSize, controlersNE, controlersDatasNE);

	sim.displays('lander');
	// sim.displays('controler');
	sim.play();

	// Save and load population to console to a String
	// let str_sim = sim.savePopulation();
	// sim.loadPopulation(str_sim);
}



function runSimulator(simulator) {
	simulator
		.setEngineConfig((engineConf) => {
			engineConf.runner.simulationSpeed = simulationSpeed;

			engineConf.plotter.squareByX = true;
			engineConf.plotter.displayGrid = false;
			engineConf.plotter.scale = {
				x : 100,
				y : 100
			};
			engineConf.plotter.scale.y = height / _pSimulationInstance.plotter.computeForXYZ(1, 1, 0, false).x;
			engineConf.plotter.offset = {
				x : 0,
				y : 0.85 * engineConf.plotter.scale.y / 2
			};

			initialConditions[0].y = 0.7 * engineConf.plotter.scale.y / 2;
		})
		// .addObjects(Simulator, 1, initialConditions, terrainPrecision);
		.addObjects(NeuroSimulator, 1, terrainPrecision);


	// Global var for the NeuralNetworkHandler
	sim = _pSimulationInstance.plotter.objectsL[0];

	launchSimulation();
}



// Generation 1845
// let vesselData = '{"m":5,"r0":{"x":-70,"y":34.1979166666666,"z":0,"color":"rgb(255, 255, 255)"},"v0":{"x":20,"y":10,"z":0,"color":"rgb(255, 255, 255)"},"thrustAngle0":0.5588753997554723,"thrustAmount0":0,"controlerName":"NeuralNetworkControler","controler":{"input_nodes":27,"hidden_nodes":20,"output_nodes":4,"neural_network":{"ih_weights":"[[0.6429314516785574,-0.8584713930699677,-0.9533589285732008,0.035584397150709,1.2203997538207234,-0.3087519698271387,0.13234158851193198,0.26324716058099856,1.17853317364156,-0.08310787315464876,-0.23665709725936515,0.7773019920686473,-1.848102429786013,-0.23724758574115778,-0.5158534561780611,-0.2437617710911096,0.877774376087898,-0.1686128395456724,0.5097271540514499,-0.8201794919685466,-1.3475058909962359,-0.34176657847047626,-0.2732960706092711,-1.3425808812028646,1.0791059054335554,-1.0926016415291322,0.7543411615164168],[-1.5214949513787337,-0.08458593622578875,-0.19530398453385242,1.8104549129973317,0.30066785712889454,-0.31635871281106803,-0.5758961472320127,0.5271323954867855,-1.7715207402051998,0.12764753006775503,0.4396798519233937,1.349444025553635,0.17531788709710824,-1.2846541025043925,-0.5847582931262865,-1.356728944319857,0.5071697169618737,-1.1837002224931772,0.9130652790788994,-0.7139479098132842,0.31159353329575873,-1.1797474207122811,-1.4906396749089335,-1.1364745006649444,-0.00020564393638251854,0.506016763729022,0.18003675206135805],[-0.4816512346950343,-0.05177553506304637,2.1482658409984845,-1.7721770848231624,2.134356478711515,2.5618755640845388,0.5391549753899612,-0.5108695677110926,0.8286630911562985,-1.6280901799650829,2.0268260385167447,0.2621597759130762,0.08212697186697313,1.262494950695594,0.34314342609417764,0.7748580857990632,0.5703118865943085,0.5142489738356328,1.1595130312775956,-0.09504521444050133,-0.28447432366484054,-0.4648794114253362,-0.6019806179095665,-0.7439690222817072,0.4225945065396671,-0.5117125521886491,-0.13766534979605924],[-0.8672503956583837,0.3381825501463823,-0.5318668254617108,1.1493887869720383,0.18244783866517358,0.9761927098178275,-0.9927803025012327,0.06579489280010362,-1.21328567850842,0.25119921355118136,-0.3224813378353323,1.7233778286038912,0.971818137645679,-0.23863296456863436,-1.4515794064777425,0.16251538455553058,0.23686181816397173,-0.2775881779732199,-1.0030045028321584,0.4026232365345227,-0.16688386389740134,0.3703121432904889,-1.0705233049431981,-0.11888990436034437,0.04613234146067445,-0.09986132630081095,0.5091170914389835],[0.3745909366779307,-1.6897001684589525,-1.0108246249131578,0.268989981757336,-0.9372235922135482,-0.11058634334995256,0.07185334312491998,0.2950784085540217,0.16958399241895383,-1.0706893927560817,0.35046290415535675,-0.042623385368117744,-1.0639435005217468,-1.1205187704982769,-0.1266794380755955,-0.2785856768291707,-0.10193244642060786,-1.0701433021665019,0.14913607420132907,-0.12272386400996,1.155606895034778,1.078545987464588,-0.13050988137280714,1.3942142642797652,0.756441540163846,-0.1326101938287875,-0.985392490170187],[0.8577996877496753,0.099656644724563,-0.6389117423676678,-0.08677897239314962,-0.4140852259968033,-0.7072031833910957,-0.1981945129532061,0.5275265725162285,0.2687001570057967,-0.06180331059678848,-0.09067535679178187,0.41171633610237995,-0.05710279298107614,-1.5789934122612717,0.4462407007896561,-0.7371254055833809,0.31576652284527384,-1.0893851447593565,0.13352887948813566,-1.0127716978499883,-0.2154437116414879,-0.021941686163973767,0.8471862236897857,-0.018681249682203492,-0.02397463320215376,-0.8681234341843054,-1.3218739124432872],[0.9201354313293039,1.1474661592649056,-1.3012908781866113,-0.6010748003858561,0.6229946118357792,-0.03874050986627574,-1.0020246077749662,0.4719252272473359,0.7027389190834996,-2.113240312194907,-0.1649481851980768,0.07001511900953415,-0.7163220067433292,-0.5574065243358263,-0.0174329767097902,-0.8684186601077655,0.2877055461569043,1.1084910026966757,1.509542518956051,1.2693753335262055,0.9107865319725563,0.3839511420657219,1.1231971988613378,1.9374205669030373,0.40171863897816656,0.2832133064540492,0.01108755033016824],[1.3117713767243022,0.7511453544713365,-0.001796195540305759,0.5723936341471926,0.24312330678440588,-0.6648211248736436,-1.2361658393179171,-1.0176609582572564,0.08088195333230865,0.49340931739336324,0.6699659547454949,0.5936658799427028,-0.030080794998641122,0.9495466170233139,-0.09455687205501992,-0.18552188968710265,0.09309291113048843,0.28661869724508926,-1.465327577768609,-0.1523548684677214,0.29660044791443063,-0.20879235907162952,0.45107418508104563,-0.20708722101853913,-1.4524443814609298,-0.9722728823417068,0.6741184312531807],[0.2837578113142887,0.5371218450965418,-1.4483429694181296,-0.5257911117584697,0.0158093957285447,-0.28953870767303846,0.7455072272890252,0.9247312996211854,-0.3166293001609836,-0.48588245724149065,-0.9337846914593534,0.45412714708960744,0.23707193817732553,1.7003821070417038,0.23943122967673403,1.3192976919534316,0.03474994004180296,0.7692052348714813,-1.303925371535303,-0.5038803389003613,-0.10100002781748899,0.031806770039994076,-0.22538487054024064,-1.5240529044235185,-0.6573617149591253,0.2717990760657759,0.9974890736832909],[0.8898930321681946,-2.4554952018385365,-0.9372100709617629,0.09740962401187972,0.4590797598822294,2.5342393278091597,0.7824123852761329,0.5110314548254284,1.196474524968365,0.6524405987076453,-0.24201912756144237,0.4714390393150689,-1.2420299003180624,-0.5044011617324116,-0.6043560127365305,-0.6313130723348778,0.5564620003966859,0.4098808075070372,-1.1934727226315147,0.09886558761940967,-0.11947262943420053,-1.6535656350391768,1.0339523414803238,-1.5000803947347663,1.5125905451669963,0.31554186360478037,-0.12060200599829085],[-1.4309070295947663,0.29045883231519404,1.2592116815717627,0.15882562431900088,0.3514139992755234,0.03490280304131595,-0.6058173415962689,1.2460784985470659,0.05764130793481881,-1.7125292449063299,-0.9846561066550785,0.4726748436745118,-2.4435398812553006,-0.9931088572849639,0.07871483458804954,-0.10404516110523825,1.5368653957951284,0.7878354894915669,-0.36668564544181936,-0.7467945136634041,-0.4207352531884117,-1.0911937866753563,-1.1247621682003488,-1.1294562511989537,0.0022838614673962587,-0.9510065157702313,-0.6518792950290409],[0.8192849376347954,1.6320300146173679,0.23630090743089605,0.3964809445953938,-0.40925289990015207,-1.0445300051926483,0.48355790774932794,1.8617205468193554,0.6382938192730303,-0.7928950083353615,-0.27641038187607575,0.08564590183590792,-0.055165399428244236,-0.3455441042716943,-0.0292467652381414,-0.40138241779023076,1.396421726979408,0.9306482386300982,0.789508067759754,0.18778894895260517,-0.23444142022803244,0.2842154402056433,0.32607677150326925,1.4416900239490762,-1.1155996863017579,-0.3362486740449529,-1.2854926624601526],[0.07360680801916464,-1.5758089093805785,1.301133411744721,-0.8900696975782818,1.560466177861765,0.19370149460046224,-0.5423048400912718,1.1205294572542104,0.4086951113932207,-0.6759435393086893,0.19111940425559554,0.8111080733912702,0.15006390567285638,0.4308431720926347,0.5751914601313453,0.06251190298825077,0.6935801010848472,-0.8380537485818347,-0.7155475698729856,-1.3348129518257648,-1.0910393075825058,-1.5333918030071467,-0.358814554330076,-0.1858956698907195,0.5313960497549804,-0.8635492868810698,-0.974992880875615],[0.8196035598003218,-0.13978173059712062,-0.3423906351979972,-0.9152592259892601,-0.3401912230567688,0.822188497279792,-0.9158943411338425,-0.7209104050723163,-1.5712164719426744,0.29087025973277586,-1.1408153584926803,-0.4143203706281114,0.8358887704464126,-1.2100948322013925,0.0635616425207705,-0.4274962522455867,-0.3976601394064557,-0.17182757395704998,-1.1235473130951414,-0.2851353252555867,-1.0525637337797018,-1.187618195505928,-0.46859536944131236,-0.05793624169022697,0.3334723881289901,0.6278821913262236,1.5273537353603799],[0.27280997054386374,-0.3239169608756936,-1.6008902556966458,-0.22948485596096846,-0.14015877637041596,-1.1351791311072321,0.9586265500213162,1.1800113283944713,-1.0804121684810697,0.859768144200422,-0.7569789492385753,0.22063576198336515,0.44239181886167955,1.1525176800663703,1.1440297403602826,0.7111156687438608,0.3521776000218466,-1.450965119289019,-1.5047638806902583,0.7070820921979163,-2.1318019570947757,-1.2181112646832255,-0.15254445041399228,0.42311172028381855,0.21015101825269217,-0.06968566155295114,-0.6607481397957616],[0.18565045620655857,0.46033788107422813,-0.11929418395250349,-1.2138954632418206,-1.0638825181402332,-1.7621682529147573,2.3200953876747,-1.6529483249220414,0.379802219349906,1.7629022320395673,0.09406768706118582,0.02698345262187725,0.39025807976915255,0.30999976234723664,0.03308826039848406,-0.2512471685909337,0.7914090102330258,0.22815181779152505,2.297381639340635,-0.5653715981275588,-0.09568782418870801,-0.8507796981975744,0.2623440913395063,-0.45358514087528656,-1.0737767488749446,0.5052560270489426,0.7076501516836403],[-0.48149248768939107,-0.04296437757745461,-0.4817234481602446,-0.7318694499664452,1.5000323967508784,-1.0070452713007014,-1.6349380998649694,-0.8097035869193783,0.24283600175850406,-0.05054370118218545,0.4392474785470976,0.7200789291865342,1.1659278102616322,1.213416100698198,0.1576367928007827,0.903849983382664,0.9297875021316563,1.1771924059178795,-1.0704883625483577,-0.44046553242633474,0.6128519629443003,-1.0747236851301147,-0.5094794003047887,-0.15283087990691602,0.047398824964797734,0.8007048495960185,-0.004839675845486643],[0.25239214861130965,-1.154925715782462,0.7995615640773877,-1.469020749940258,0.07375211767831324,-0.8251039880681957,-1.3104965497363619,0.16815693767964288,0.1555603809734529,-0.6708383950835054,0.3607057875876121,-0.048099615687510325,0.06815570595613077,-0.5483526568528407,-0.9361215003601934,-1.100245266282567,1.1136998406061542,0.47894483759807266,-0.3489280015144363,0.6388900110446829,-0.054620800893448326,-0.051524106828134075,-0.78040312121497,0.7103011972709736,-1.3848554627739134,-0.03937766881318622,-0.25187151649605166],[-0.628905507879379,-0.363724639540958,0.1312392852490821,0.9208318912281577,-1.587264554499782,-2.110333429207326,0.23706284333064084,-0.005361829807904853,-1.3145680872615761,0.34004236986493414,-0.31592096330017966,-0.07493571124597914,-1.118444013259374,0.8785380022836884,-0.023035221677452908,0.7107692825728489,0.47299994862302164,-0.04388853500538206,0.4848230865173412,-0.2616854283066534,-1.2452205980165694,-0.6365235879767616,0.48294146642962815,0.296206635105953,-0.32088689079459043,-0.10725507371654422,0.16645939495027753],[-0.21910181104198764,-0.8210810133104182,-0.6230052270580657,-0.7474836845665078,-1.7788684606288625,1.857063475652993,-0.6330935773470002,-1.4133908038996852,0.2885454216748561,0.3999936560497965,0.5836929797192149,-0.5528716680695241,-1.5757042083952266,-0.8144757413826633,-0.38615117963432866,0.5739982401441261,0.7586869110947851,-0.8725985247022594,-0.5944498927966616,1.6035889710630995,-0.1902464213548154,0.33793805961199536,0.21139587071100113,-0.5191053809253093,-1.1529407715751925,-0.5215543297331798,0.4406598996922293]]","ho_weights":"[[1.0439359508246648,0.22624036897442257,-0.7189629807618303,0.9644798917596886,0.15701173943234387,0.7103956977669024,0.6890489583475148,-0.9006618335428449,-0.985741515301051,-0.06092322414634722,0.1633545202190833,0.6713244153027321,-0.5879384586056478,0.361337834866327,1.5275743523423535,-0.8504797729430661,0.6615695016892342,-0.36316286733977066,0.7423805186256663,-0.9073737361540023],[-1.4212042387957784,0.8438539565038918,-0.6677509155667284,-1.064782366068063,-0.46719726526615285,-1.4110897287041433,2.2523557662537224,-1.2412040737296204,-0.5989864148716033,0.24798918890553295,-0.9575875340692502,-0.0540299119556698,-0.6126846140068856,-1.1807187240304484,-1.173877546578289,-0.8533516913116711,0.1776550082915644,1.3075211369780089,0.35294115617768634,0.49122962426281475],[-0.8372560844978492,0.978836793671625,-1.7595254409017984,-0.9291906584805589,-0.5688542935161378,0.8733241164009914,-0.6414120953705298,-0.7708802983232499,0.477060165778613,-0.7798012447544791,1.3984079631453852,-0.1809408039864833,-1.1945499901362622,1.9003094136246084,0.019082828459416598,0.4249680371591779,0.4632206405699527,-0.41825594787729076,0.4070994490151616,0.4597597086093101],[-0.28404434627619024,0.700222993361377,1.3012832529630125,-0.8168065970705383,1.8950186110315432,0.02683102844349058,0.1926133364970177,-0.43291039450055857,-0.2726085265440344,-0.5678489347740796,0.9040801127628356,-0.6649956579077693,0.4749680075153964,-0.4804660317851881,0.446953423120627,-0.9255377613435383,-0.4504567829950347,-0.09004116194705668,-1.004322271295873,-0.49280410090262283]]","ih_bias":"[[0.448219708854298],[0.701341292700643],[-1.7178584128202767],[1.37204698679867],[0.4249014223173263],[0.21566690638869865],[-0.29363161045843095],[0.07392163999425234],[-1.2577064869191454],[0.6762678237643822],[0.8128318436749997],[1.5052150402554825],[-0.7791414828277502],[1.6200552064242961],[0.09685083367610572],[0.1600768856098441],[-0.5100043366481561],[-0.9633661589792945],[1.1558801560884595],[-0.8192036189571761]]","ho_bias":"[[0.760052679898744],[1.6087914609887437],[0.7024200012066967],[0.19599595186215923]]","weights_datas":{"max":2.5618755640845388,"min":-2.4554952018385365},"input_nodes":27,"hidden_nodes":20,"output_nodes":4}}}';
